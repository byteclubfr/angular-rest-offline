!function(a,b){"use strict";b.module("restOffline",["uuid","LocalForageModule"])}(window,window.angular),function(a,b){"use strict";b.module("restOffline").provider("OfflineService",function(){var a={apiUrl:"/api/",apis:{}};this.setApis=function(b){b.forEach(function(b){a.apis[b.ressource]={finder:b.finder||function(a,b){var c=!1;return a.some(function(a){return a.id===b?(c=a,!0):!1}),c}}})},this.setApiUrl=function(b){a.apiUrl=b},this.$get=function(b,c,d,e){var f={},g=function(b){if(0!==b.indexOf(a.apiUrl))return!1;var c=document.createElement("a");c.href=b;var d=c.pathname.slice(a.apiUrl.length).split("/");return!a.apis[d[0]]||d.length>2?!1:{ressourceKey:d[0],id:d[1]||!1}},h=function(a){return a.headers.requestUuid||(a.headers.requestUuid=d.v4()),b.getItem("historyRequest").then(function(a){return a||[]}).then(function(c){return c.some(function(b){return b.uuid===a.headers.requestUuid})?a:(c.push({uuid:a.headers.requestUuid,url:a.url,method:a.method,data:a.data}),b.setItem("historyRequest",c).then(function(){return e.$broadcast("OfflineService:needSync",!0),a}))})},i=function(a){return a?b.getItem("historyRequest").then(function(a){return a||[]}).then(function(b){return b.filter(function(b){return b.uuid===a})}):void 0},j=function(a){return a?b.getItem("historyRequest").then(function(a){return a||[]}).then(function(c){var d=c.length;return c=c.filter(function(b){return b.uuid!==a}),d===c.length?c:b.setItem("historyRequest",c).then(function(){return c.length||e.$broadcast("OfflineService:needSync",!1),c})}):void 0},k=function(d){return d.id?b.getItem(d.ressourceKey).then(function(b){var e=a.apis[d.ressourceKey].finder(b,d.id);return e?e:c.reject()}):b.getItem(d.ressourceKey)},l=function(c,d){return c.id?b.getItem(c.ressourceKey).then(function(e){e=e||[];var f=a.apis[c.ressourceKey].finder(e,c.id);if(f)for(var g in d)f[g]=d[g];else e.push(f);return b.setItem(c.ressourceKey,e)}):b.setItem(c.ressourceKey,d)};return{response:function(a){var b=g(a.config.url);return b?("GET"===a.config.method?a.data.offline?a.data=k(b):l(b,a.data):j(a.config.headers.requestUuid),a):a},responseError:function(b){if(g(a.url)&&!b.status){var d=b.config.headers.requestUuid;if(a=i(d).then(function(a){return a}),f[d])return b.data=f[d].then(function(a){return a}),b}return c.reject(b)},request:function(a){var c=g(a.url);return!c||"GET"===a.method||a.headers.requestUuid?a:h(a).then(function(a){switch(a.method){case"POST":f[a.headers.requestUuid]=b.getItem(c.ressourceKey).then(function(d){return d.push(a.data),b.setItem(c.ressourceKey,d),a.data});break;case"PUT":break;case"DELETE":}return a})}}}})}(window,window.angular),function(a,b){"use strict";b.module("restOffline").factory("OfflineSyncUpService",function(a,b){return{syncUp:function(){var c=this;return a.getItem("historyRequest").then(function(a){return a||[]}).then(function(a){if(a.length){var d=a[0];return b({method:d.method,url:d.url,data:d.data,headers:{requestUuid:d.uuid}}).then(function(){return c.syncUp()})}})}}})}(window,window.angular);