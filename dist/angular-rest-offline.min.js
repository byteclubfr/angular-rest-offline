!function(a,b){"use strict";b.module("restOffline",["uuid","LocalForageModule"])}(window,window.angular),function(a,b){"use strict";b.module("restOffline").provider("OfflineService",function(){config={apiUrl:"/api/",apis:{}},this.setApis=function(a){a.forEach(function(a){config.apis[a.ressource]={finder:a.finder||function(a,b){var c=!1;return a.some(function(a){return a.id===b?(c=a,!0):!1}),c}}})},this.setApiUrl=function(a){config.apiUrl=a},this.$get=function(a,b,c,d){var e={},f=function(a){if(0!==a.indexOf(config.apiUrl))return!1;var b=document.createElement("a");b.href=a;var c=b.pathname.slice(config.apiUrl.length).split("/");return!config.apis[c[0]]||c.length>2?!1:{ressourceKey:c[0],id:c[1]||!1}},g=function(b){return b.headers.requestUuid||(b.headers.requestUuid=c.v4()),a.getItem("historyRequest").then(function(a){return a||[]}).then(function(c){return c.some(function(a){return a.uuid===b.headers.requestUuid})?b:(c.push({uuid:b.headers.requestUuid,url:b.url,method:b.method,data:b.data}),a.setItem("historyRequest",c).then(function(){return d.$broadcast("OfflineService:needSync",!0),b}))})},h=function(b){return b?a.getItem("historyRequest").then(function(a){return a||[]}).then(function(a){return a.filter(function(a){return a.uuid===b})}):void 0},i=function(b){return b?a.getItem("historyRequest").then(function(a){return a||[]}).then(function(c){var e=c.length;return c=c.filter(function(a){return a.uuid!==b}),e===c.length?c:a.setItem("historyRequest",c).then(function(){return c.length||d.$broadcast("OfflineService:needSync",!1),c})}):void 0},j=function(c){return c.id?a.getItem(c.ressourceKey).then(function(a){var d=config.apis[c.ressourceKey].finder(a,c.id);return d?d:b.reject()}):a.getItem(c.ressourceKey)},k=function(b,c){return b.id?a.getItem(b.ressourceKey).then(function(d){d=d||[];var e=config.apis[b.ressourceKey].finder(d,b.id);if(e)for(var f in c)e[f]=c[f];else d.push(e);return a.setItem(b.ressourceKey,d)}):a.setItem(b.ressourceKey,c)};return{response:function(a){var b=f(a.config.url);return b?("GET"===a.config.method?a.data.offline?a.data=j(b):k(b,a.data):i(a.config.headers.requestUuid),a):a},responseError:function(a){if(f(config.url)&&!a.status){var c=a.config.headers.requestUuid;if(config=h(c).then(function(a){return a}),e[c])return a.data=e[c].then(function(a){return a}),a}return b.reject(a)},request:function(b){var c=f(b.url);return!c||"GET"===b.method||b.headers.requestUuid?b:g(b).then(function(b){switch(b.method){case"POST":e[b.headers.requestUuid]=a.getItem(c.ressourceKey).then(function(d){return d.push(b.data),a.setItem(c.ressourceKey,d),b.data});break;case"PUT":break;case"DELETE":}return b})}}}})}(window,window.angular),function(a,b){"use strict";b.module("restOffline").factory("OfflineSyncUpService",function(a,b){return{syncUp:function(){var c=this;return a.getItem("historyRequest").then(function(a){return a||[]}).then(function(a){if(a.length){var d=a[0];return b({method:d.method,url:d.url,data:d.data,headers:{requestUuid:d.uuid}}).then(function(){return c.syncUp()})}})}}})}(window,window.angular);